---
layout: post
title:  "脆弱性検証レポ CVE-2019-7192~7195"
subtitle: "QNAP QTSおよびPhoto Stationの脆弱性(CVE-2019-7192~7195)関する検証レポ"
date:   2020-08-15 00:00:00
categories: [vulnerability]
---

<font color="red">※本投稿に記載の内容は犯罪行為を助長するものではありません。必ず自身の管理下にあるネットワークやサーバーに対してのみ実施してください。</font>


## 概要
- QNAP NASに、リモートより任意のコードが実行可能な脆弱性（CVE-2019-7192 ~ CVE-2019-7195）及び、その脆弱性を利用する攻撃コードが発見されました。この脆弱性を利用した攻撃が成立した場合、ルート権限で任意のコードを実行される危険性があります。
ランサムウェア「eCh0raix」は、当該脆弱性を悪用して感染するランサムウェアであることが報告されています。


## 影響を受けるシステム

- 下記QTSのバージョン
  - QTS 4.4.1 build 20190918 以前のバージョン
  - QTS 4.3.6 build 20190919 以前のバージョン


- 下記Photo Stationのバージョン
  - QTS 4.4.1：Photo Station 6.0.3 以前のバージョン
  - QTS 4.3.4 - QTS 4.4.0：Photo Station 5.7.10 以前のバージョン
  - QTS 4.3.0 - QTS 4.3.3：Photo Station 5.4.9 以前のバージョン
  - QTS 4.2.6：Photo Station 5.2.11 以前のバージョン


## 検証
- ターゲットに対し、細工したリクエストを送信することにより、このターゲットにてルート権限で任意のコマンドが実行可能となります。
  ### 1. 検証環境
  - 攻撃者の環境
    - Windows 10 Pro 64bit
  - ターゲットの環境
    - Photo Station 5.4.1(QTS 4.3.4)

  ### 2. 検証イメージ
  ![検証イメージ図]({{site.baseurl}}/images/CVE-2019-7192_7195_01.png)

  ### 3. 検証結果
  - 下図は、ターゲットに対して細工したリクエストを送信した際の画面です。ターゲットに対して任意のコマンド（/etc/passwdの内容を取得するコマンド）を実行し、コマンドの実行結果（/etc/passwd の内容）が表示されていることを確認できます。
  ![検証結果]({{site.baseurl}}/images/CVE-2019-7192_7195_02.png)

  ### 4. 今回使用したコード
  - [CVE-2019-7192_QNAP_Exploit](https://github.com/th3gundy/CVE-2019-7192_QNAP_Exploit)  
Yunus YILDIRIM氏に感謝します！

## 対策
- QNAPより、この脆弱性を修正するバージョンがリリースされています。以下の手順でQTSとPhoto Stationを最新バージョンに更新いただくことを推奨します。
  ### 1. QTSアップデートのインストール
  1. 特権ユーザでQTSにログインします。
  2. コントロールパネル > システム > ファームウェア更新 に移動します。
  3. 「ライブ更新」タブの「更新の確認」ボタンをクリックします。
  ![QTSアップデート]({{site.baseurl}}/images/CVE-2019-7192_7195_03.png)

  ### 2. Photo Stationの更新
  1. 特権ユーザでQTSにログインします。
  2. App Centerを開きます
  3. 検索ボックスで「Photo Station」と入力し、Enterキーを押下します。
  4. 「更新」をクリックします。
  5. 確認メッセージが表示されるので、「OK」をクリックします。
  ![Photo Stationアップデート]({{site.baseurl}}/images/CVE-2019-7192_7195_04.png)

## 参考サイト
- [CVE-2019-7192](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2019-7192)
- [Security Advisory for Vulnerability in QTS and Photo Station](https://www.qnap.com/en/security-advisory/nas-201911-25)
- [QNAP Pre-Auth Root RCE Affecting ~312K Devices on the Internet](https://medium.com/@cycraft_corp/qnap-pre-auth-root-rce-affecting-312k-devices-on-the-internet-fc8af285622e)
- [QNAP 社製 NAS および Photo Station に影響を与えるランサムウエアに関する情報について](https://www.jpcert.or.jp/newsflash/2020060901.html)

***

